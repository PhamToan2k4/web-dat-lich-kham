<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω L·ªãch H·∫πn - Admin</title>
    <link rel="stylesheet" href="admin_style.css"> 
    <style>
        /* CSS B·ªë c·ª•c (K·∫ø th·ª´a t·ª´ Dashboard) */
        body { font-family: Arial, sans-serif; background-color: #e9ecef; margin: 0; display: flex; }
        .sidebar { width: 250px; background-color: #343a40; color: white; padding: 20px; height: 100vh; position: fixed; }
        .sidebar a { display: block; padding: 10px; color: #adb5bd; text-decoration: none; border-radius: 4px; margin-bottom: 5px; }
        .sidebar a:hover, .sidebar a.active { background-color: #007bff; color: white; }
        .main-content { margin-left: 250px; flex-grow: 1; padding: 30px; }
        
        /* CSS cho B·∫£ng & C√¥ng c·ª• */
        .management-panel { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .filter-area { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; align-items: center; }
        .filter-area input, .filter-area select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        .appointment-table th, .appointment-table td { padding: 12px; border-bottom: 1px solid #dee2e6; text-align: left; font-size: 0.9em; }
        .appointment-table { width: 100%; border-collapse: collapse; }

        /* Tr·∫°ng th√°i m√†u s·∫Øc */
        .status-badge { padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 0.8em; }
        .status-pending { background-color: #ffc107; color: #343a40; }
        .status-confirmed { background-color: #28a745; color: white; }
        .status-completed { background-color: #007bff; color: white; }
        .status-cancelled { background-color: #dc3545; color: white; }
        .action-btns button { margin-right: 5px; padding: 6px 10px; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>üë®‚Äçüíª Admin Panel</h2>
        <p style="color: #6c757d; border-bottom: 1px solid #495057; padding-bottom: 15px; margin-bottom: 15px;">Menu Ch√≠nh</p>
        <a href="admin_dashboard.html">Dashboard & T·ªïng quan</a>
        <a href="admin_manage_doctors.html">Qu·∫£n l√Ω B√°c sƒ©</a>
        <a href="admin_manage_appointments.html" class="active">Qu·∫£n l√Ω L·ªãch h·∫πn</a>
        <a href="admin_reports.html">Th·ªëng k√™ - B√°o c√°o</a>
        <div style="margin-top: 50px;">
            <a href="login_register.html" onclick="logout()" style="background-color: #dc3545; color: white;">ƒêƒÉng Xu·∫•t</a>
        </div>
    </div>

    <div class="main-content">
        <h1>üóìÔ∏è Qu·∫£n L√Ω L·ªãch H·∫πn</h1>
        <p>Gi√°m s√°t v√† theo d√µi t·∫•t c·∫£ c√°c l·ªãch h·∫πn trong h·ªá th·ªëng.</p>
        
        <div class="management-panel">
            
            <div class="filter-area">
                <input type="date" id="filter-date-from" title="T·ª´ Ng√†y">
                <input type="date" id="filter-date-to" title="ƒê·∫øn Ng√†y">
                
                <select id="filter-doctor" title="L·ªçc theo B√°c sƒ©">
                    <option value="all">T·∫•t c·∫£ B√°c sƒ©</option>
                    <option value="kh·ªèe">BS. Nguy·ªÖn Kh·ªèe</option>
                    <option value="linh">BS. Tr·∫ßn Linh</option>
                    <option value="an">BS. Ph·∫°m An</option>
                </select>
                
                <select id="filter-status">
                    <option value="all">T·∫•t c·∫£ Tr·∫°ng th√°i</option>
                    <option value="pending">Ch·ªù x√°c nh·∫≠n</option>
                    <option value="confirmed">ƒê√£ x√°c nh·∫≠n</option>
                    <option value="completed">ƒê√£ ho√†n th√†nh</option>
                    <option value="cancelled">ƒê√£ h·ªßy</option>
                </select>
                
                <button onclick="applyFilters()" style="padding: 8px 15px; background-color: #6c757d; color: white; border: none; border-radius: 4px;">√Åp D·ª•ng L·ªçc</button>
            </div>

            <div style="display: flex; gap: 20px; margin-bottom: 20px; padding: 10px; border: 1px solid #eee; border-radius: 4px;">
                <p><strong>T·ªïng s·ªë l·ªãch h·∫πn (ƒë√£ l·ªçc):</strong> <span id="total-filtered">120</span></p>
                <p><strong>S·ªë l∆∞·ª£ng ƒê√£ h·ªßy:</strong> <span id="total-cancelled">15</span></p>
            </div>

            <table class="appointment-table">
                <thead>
                    <tr>
                        <th>M√£ H·∫πn</th>
                        <th>B·ªánh Nh√¢n</th>
                        <th>B√°c Sƒ©</th>
                        <th>Ng√†y & Gi·ªù</th>
                        <th>Chuy√™n Khoa</th>
                        <th>Tr·∫°ng Th√°i</th>
                        <th>H√†nh ƒê·ªông</th>
                    </tr>
                </thead>
                <tbody id="appointment-list">
                    </tbody>
            </table>

            <div style="margin-top: 20px; text-align: center;">
                <button disabled style="padding: 8px 15px;">&laquo; Tr∆∞·ªõc</button>
                <span style="margin: 0 10px;">Trang 1 / 10</span>
                <button style="padding: 8px 15px;">Sau &raquo;</button>
            </div>

        </div>

    </div>

    <div id="status-modal" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 8px; max-width: 400px; width: 100%;">
            <h2>Ch·ªânh S·ª≠a Tr·∫°ng Th√°i #<span id="modal-appointment-id"></span></h2>
            <div class="form-group"><label>Thay ƒë·ªïi tr·∫°ng th√°i:</label>
                <select id="new-status" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                    <option value="pending">Ch·ªù x√°c nh·∫≠n</option>
                    <option value="confirmed">ƒê√£ x√°c nh·∫≠n</option>
                    <option value="completed">ƒê√£ ho√†n th√†nh</option>
                    <option value="cancelled">ƒê√£ h·ªßy</option>
                </select>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button onclick="saveNewStatus()" style="background-color: #007bff; color: white; padding: 10px 15px;">L∆∞u Thay ƒê·ªïi</button>
                <button onclick="closeStatusModal()" style="margin-left: 10px; padding: 10px 15px;">H·ªßy</button>
            </div>
        </div>
    </div>


    <script>
        // D·ªØ li·ªáu gi·∫£ l·∫≠p (mock data)
        let appointmentsData = [
            { id: 2001, patient: 'Nguy·ªÖn VƒÉn A', doctor: 'BS. Kh·ªèe', specialty: 'da_lieu', datetime: '12/11/2025 09:00', status: 'confirmed', reason: 'N·ªïi m·∫©n ƒë·ªè' },
            { id: 2002, patient: 'Tr·∫ßn Th·ªã B', doctor: 'BS. Linh', specialty: 'nhi', datetime: '12/11/2025 10:30', status: 'pending', reason: 'S·ªët cao' },
            { id: 2003, patient: 'Ph·∫°m VƒÉn C', doctor: 'BS. An', specialty: 'tim_mach', datetime: '11/11/2025 14:00', status: 'completed', reason: 'T√°i kh√°m tim' },
            { id: 2004, patient: 'L√™ H·∫£i D', doctor: 'BS. Kh·ªèe', specialty: 'da_lieu', datetime: '11/11/2025 16:00', status: 'cancelled', reason: 'B·∫≠n ƒë·ªôt xu·∫•t' },
            // ... th√™m d·ªØ li·ªáu gi·∫£ l·∫≠p kh√°c ...
        ];
        
        let currentAppointmentId = null;

        // --- H√†m T·∫£i v√† Hi·ªÉn th·ªã L·ªãch h·∫πn ---
        function renderAppointmentList(data) {
            const tbody = document.getElementById('appointment-list');
            tbody.innerHTML = ''; 

            let totalCancelled = 0;
            
            data.forEach(app => {
                const statusInfo = getStatusInfo(app.status);
                const specialtyLabel = getSpecialtyLabel(app.specialty);
                if (app.status === 'cancelled') totalCancelled++;

                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${app.id}</td>
                    <td>${app.patient}</td>
                    <td>${app.doctor}</td>
                    <td>${app.datetime}</td>
                    <td>${specialtyLabel}</td>
                    <td><span class="status-badge ${statusInfo.class}">${statusInfo.label}</span></td>
                    <td class="action-btns">
                        <button onclick="viewDetails(${app.id})" style="background-color: #17a2b8; color: white;">Chi Ti·∫øt</button>
                        <button onclick="openStatusModal(${app.id}, '${app.status}')" style="background-color: #ffc107;">S·ª≠a TT</button>
                    </td>
                `;
            });
            
            document.getElementById('total-filtered').textContent = data.length;
            document.getElementById('total-cancelled').textContent = totalCancelled;

            if (data.length === 0) {
                 tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px;">Kh√¥ng t√¨m th·∫•y l·ªãch h·∫πn n√†o ph√π h·ª£p.</td></tr>';
            }
        }

        function getStatusInfo(status) {
             switch (status) {
                case 'pending': return { label: 'Ch·ªù x√°c nh·∫≠n', class: 'status-pending' };
                case 'confirmed': return { label: 'ƒê√£ x√°c nh·∫≠n', class: 'status-confirmed' };
                case 'completed': return { label: 'ƒê√£ ho√†n th√†nh', class: 'status-completed' };
                case 'cancelled': return { label: 'ƒê√£ h·ªßy', class: 'status-cancelled' };
                default: return { label: 'Kh√¥ng r√µ', class: '' };
            }
        }

        function getSpecialtyLabel(key) {
             const specialties = { 'da_lieu': 'Da Li·ªÖu', 'tim_mach': 'Tim M·∫°ch', 'nhi': 'Nhi', 'nha_khoa': 'Nha Khoa' };
             return specialties[key] || key;
        }

        // --- H√†m L·ªçc & T√¨m ki·∫øm ---
        function applyFilters() {
            // L·∫•y gi√° tr·ªã l·ªçc (m√¥ ph·ªèng)
            const dateFrom = document.getElementById('filter-date-from').value;
            const dateTo = document.getElementById('filter-date-to').value;
            const filterDoctor = document.getElementById('filter-doctor').value;
            const filterStatus = document.getElementById('filter-status').value;

            // Trong th·ª±c t·∫ø, b·∫°n s·∫Ω g·ªçi API ·ªü ƒë√¢y v·ªõi c√°c tham s·ªë n√†y
            console.log(`API Call: L·ªçc l·ªãch h·∫πn: T·ª´ ${dateFrom} ƒë·∫øn ${dateTo}, BS: ${filterDoctor}, TT: ${filterStatus}`);
            
            // Gi·∫£ l·∫≠p l·ªçc
            const filteredList = appointmentsData.filter(app => {
                 const statusMatch = filterStatus === 'all' || app.status === filterStatus;
                 // Gi·∫£ l·∫≠p logic l·ªçc ph·ª©c t·∫°p h∆°n
                 return statusMatch; 
            });

            renderAppointmentList(filteredList);
        }

        // --- H√†m Qu·∫£n l√Ω Tr·∫°ng th√°i (Admin Actions) ---

        function openStatusModal(id, currentStatus) {
            currentAppointmentId = id;
            document.getElementById('modal-appointment-id').textContent = id;
            document.getElementById('new-status').value = currentStatus;
            document.getElementById('status-modal').style.display = 'flex';
        }

        function closeStatusModal() {
             document.getElementById('status-modal').style.display = 'none';
             currentAppointmentId = null;
        }

        function saveNewStatus() {
            const id = currentAppointmentId;
            const newStatus = document.getElementById('new-status').value;

            console.log(`API Call: Admin thay ƒë·ªïi tr·∫°ng th√°i h·∫πn ID ${id} th√†nh ${newStatus}`);
            
            // C·∫≠p nh·∫≠t mock data (gi·∫£ l·∫≠p)
            const app = appointmentsData.find(a => a.id === id);
            if (app) app.status = newStatus;
            
            closeStatusModal();
            applyFilters(); 
            alert(`ƒê√£ c·∫≠p nh·∫≠t tr·∫°ng th√°i l·ªãch h·∫πn #${id} th√†nh c√¥ng!`);
        }

        function viewDetails(id) {
            const app = appointmentsData.find(a => a.id === id);
            alert(`Chi ti·∫øt L·ªãch h·∫πn #${id}:\nB·ªánh nh√¢n: ${app.patient}\nB√°c sƒ©: ${app.doctor}\nL√Ω do kh√°m: ${app.reason}\nTh·ªùi gian: ${app.datetime}`);
        }

        function logout() {
            console.log('ƒêƒÉng xu·∫•t Admin');
            // window.location.href = 'login_register.html';
        }

        // Kh·ªüi ch·∫°y khi t√†i li·ªáu t·∫£i xong
        document.addEventListener('DOMContentLoaded', () => {
             // ƒê·∫∑t ng√†y m·∫∑c ƒë·ªãnh cho b·ªô l·ªçc (m√¥ ph·ªèng)
             const today = new Date().toISOString().split('T')[0];
             document.getElementById('filter-date-to').value = today;
             // T·∫£i d·ªØ li·ªáu ban ƒë·∫ßu
             renderAppointmentList(appointmentsData);
        });
    </script>
</body>
</html>