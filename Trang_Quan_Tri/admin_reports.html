<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ªëng K√™ & B√°o C√°o - Admin</title>
    <link rel="stylesheet" href="admin_style.css"> 
    <style>
        /* CSS B·ªë c·ª•c (K·∫ø th·ª´a t·ª´ Dashboard) */
        body { font-family: Arial, sans-serif; background-color: #e9ecef; margin: 0; display: flex; }
        .sidebar { width: 250px; background-color: #343a40; color: white; padding: 20px; height: 100vh; position: fixed; }
        .sidebar a { display: block; padding: 10px; color: #adb5bd; text-decoration: none; border-radius: 4px; margin-bottom: 5px; }
        .sidebar a:hover, .sidebar a.active { background-color: #007bff; color: white; }
        .main-content { margin-left: 250px; flex-grow: 1; padding: 30px; }
        
        /* CSS cho B√°o c√°o */
        .report-panel { background-color: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .chart-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
        
        /* CSS cho B·∫£ng x·∫øp h·∫°ng */
        .top-doctors th, .top-doctors td { padding: 10px; border-bottom: 1px solid #dee2e6; text-align: left; }
        .top-doctors { width: 100%; border-collapse: collapse; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
</head>
<body>

    <div class="sidebar">
        <h2>üë®‚Äçüíª Admin Panel</h2>
        <p style="color: #6c757d; border-bottom: 1px solid #495057; padding-bottom: 15px; margin-bottom: 15px;">Menu Ch√≠nh</p>
        <a href="admin_dashboard.html">Dashboard & T·ªïng quan</a>
        <a href="admin_manage_doctors.html">Qu·∫£n l√Ω B√°c sƒ©</a>
        <a href="admin_manage_appointments.html">Qu·∫£n l√Ω L·ªãch h·∫πn</a>
        <a href="admin_reports.html" class="active">Th·ªëng k√™ - B√°o c√°o</a>
        <div style="margin-top: 50px;">
            <a href="login_register.html" onclick="logout()" style="background-color: #dc3545; color: white;">ƒêƒÉng Xu·∫•t</a>
        </div>
    </div>

    <div class="main-content">
        <h1>üìä Th·ªëng K√™ & B√°o C√°o</h1>
        <p>Ph√¢n t√≠ch hi·ªáu su·∫•t h·ªá th·ªëng v√† xu h∆∞·ªõng ƒë·∫∑t kh√°m.</p>
        
        <div class="report-panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <div>
                    <label for="date-range">Ch·ªçn K·ª≥ B√°o C√°o:</label>
                    <input type="month" id="date-range" value="2025-11" onchange="loadReportData()">
                    <button onclick="loadReportData()" style="padding: 8px 15px; background-color: #6c757d; color: white; border: none; border-radius: 4px;">Xem</button>
                </div>
                
                <button onclick="exportReport()" style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; font-weight: bold; cursor: pointer;">
                    ‚¨áÔ∏è Xu·∫•t B√°o C√°o (PDF/Excel)
                </button>
            </div>

            <div class="chart-grid">
                <div>
                    <h2>L∆∞·ª£t Kh√°m Ho√†n Th√†nh (Th√°ng 11/2025)</h2>
                    <canvas id="appointment-trend-chart" height="150"></canvas>
                </div>
                
                <div style="max-width: 400px; margin: auto;">
                    <h2>T·ª∑ L·ªá ƒê·∫∑t Kh√°m theo Chuy√™n Khoa</h2>
                    <canvas id="specialty-pie-chart" height="200"></canvas>
                </div>
            </div>
            
        </div>
        
        <div class="report-panel">
            <h2>ü•á Top 5 B√°c Sƒ© C√≥ L∆∞·ª£t ƒê·∫∑t Kh√°m Cao Nh·∫•t</h2>
            <table class="top-doctors">
                <thead>
                    <tr>
                        <th>H·∫°ng</th>
                        <th>T√™n B√°c Sƒ©</th>
                        <th>Chuy√™n Khoa</th>
                        <th>T·ªïng L∆∞·ª£t Ho√†n Th√†nh</th>
                        <th>Rating Trung B√¨nh</th>
                    </tr>
                </thead>
                <tbody id="top-doctors-list">
                    </tbody>
            </table>
        </div>

    </div>

    <script>
        // D·ªØ li·ªáu gi·∫£ l·∫≠p cho B√°o c√°o (T√πy thu·ªôc v√†o b·ªô l·ªçc th·ªùi gian)
        const mockReportData = {
            trend: {
                labels: ['Tu·∫ßn 1', 'Tu·∫ßn 2', 'Tu·∫ßn 3', 'Tu·∫ßn 4'],
                completed: [550, 620, 580, 710],
                cancelled: [50, 70, 60, 80]
            },
            specialty: [
                { name: 'Nhi', count: 350, color: '#007bff' },
                { name: 'Da Li·ªÖu', count: 510, color: '#28a745' },
                { name: 'Tim M·∫°ch', count: 420, color: '#ffc107' },
                { name: 'Nha Khoa', count: 180, color: '#dc3545' },
                { name: 'Kh√°c', count: 200, color: '#6c757d' }
            ],
            topDoctors: [
                { rank: 1, name: 'BS. Tr·∫ßn Th·ªã Linh', specialty: 'Nhi', count: 185, rating: 4.9 },
                { rank: 2, name: 'BS. Nguy·ªÖn VƒÉn Kh·ªèe', specialty: 'Da Li·ªÖu', count: 162, rating: 4.8 },
                { rank: 3, name: 'BS. Ph·∫°m VƒÉn An', specialty: 'Tim M·∫°ch', count: 140, rating: 4.5 },
                { rank: 4, name: 'BS. Ho√†ng Y·∫øn', specialty: 'Da Li·ªÖu', count: 121, rating: 4.7 },
                { rank: 5, name: 'BS. L√™ H·∫£i V√¢n', specialty: 'Nha Khoa', count: 98, rating: 4.6 }
            ]
        };
        
        let trendChart = null;
        let pieChart = null;

        // --- H√†m T·∫£i D·ªØ li·ªáu B√°o c√°o ---
        function loadReportData() {
            const dateRange = document.getElementById('date-range').value;
            console.log(`API Call: L·∫•y d·ªØ li·ªáu b√°o c√°o cho k·ª≥: ${dateRange}`);
            
            // 1. Render Bi·ªÉu ƒë·ªì Xu h∆∞·ªõng
            renderAppointmentTrendChart(mockReportData.trend);

            // 2. Render Bi·ªÉu ƒë·ªì Chuy√™n khoa
            renderSpecialtyPieChart(mockReportData.specialty);

            // 3. Render B·∫£ng Top B√°c sƒ©
            renderTopDoctors(mockReportData.topDoctors);
        }

        // --- H√†m V·∫Ω Bi·ªÉu ƒë·ªì Xu h∆∞·ªõng (Line Chart) ---
        function renderAppointmentTrendChart(data) {
            const ctx = document.getElementById('appointment-trend-chart').getContext('2d');
            
            if (trendChart) trendChart.destroy(); // X√≥a bi·ªÉu ƒë·ªì c≈© n·∫øu c√≥

            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        {
                            label: 'Ho√†n Th√†nh',
                            data: data.completed,
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.2)',
                            fill: true, tension: 0.3
                        },
                        {
                            label: 'ƒê√£ H·ªßy',
                            data: data.cancelled,
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.2)',
                            fill: true, tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: { y: { beginAtZero: true } },
                    plugins: { title: { display: false } }
                }
            });
        }

        // --- H√†m V·∫Ω Bi·ªÉu ƒë·ªì Chuy√™n khoa (Pie Chart) ---
        function renderSpecialtyPieChart(data) {
            const ctx = document.getElementById('specialty-pie-chart').getContext('2d');

            if (pieChart) pieChart.destroy(); // X√≥a bi·ªÉu ƒë·ªì c≈© n·∫øu c√≥

            pieChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: data.map(d => d.name),
                    datasets: [{
                        data: data.map(d => d.count),
                        backgroundColor: data.map(d => d.color),
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'right' }
                    }
                }
            });
        }

        // --- H√†m Hi·ªÉn th·ªã B·∫£ng Top B√°c sƒ© ---
        function renderTopDoctors(data) {
            const tbody = document.getElementById('top-doctors-list');
            tbody.innerHTML = ''; 

            data.forEach((doctor, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${doctor.rank}</td>
                    <td>${doctor.name}</td>
                    <td>${doctor.specialty}</td>
                    <td>${doctor.count}</td>
                    <td>${doctor.rating} ‚≠ê</td>
                `;
            });
        }
        
        // --- H√†m Xu·∫•t B√°o C√°o ---
        function exportReport() {
            const dateRange = document.getElementById('date-range').value;
            console.log(`API Call: Xu·∫•t b√°o c√°o cho k·ª≥: ${dateRange} (M√¥ ph·ªèng)`);
            alert(`M√¥ ph·ªèng: ƒê√£ t·∫°o v√† t·∫£i file B√°o C√°o th√°ng ${dateRange}.`);
        }
        
        function logout() {
            console.log('ƒêƒÉng xu·∫•t Admin');
            // window.location.href = 'login_register.html';
        }

        // Kh·ªüi ch·∫°y khi t√†i li·ªáu t·∫£i xong
        document.addEventListener('DOMContentLoaded', loadReportData);
    </script>
</body>
</html>