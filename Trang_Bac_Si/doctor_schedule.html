<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªãch Kh√°m C·ªßa T√¥i - B√°c Sƒ© [T√™n BS]</title>
    <link rel="stylesheet" href="../assets/css/style.css"> 
    <style>
        /* CSS C∆° B·∫£n Cho Trang N√†y */
        body { font-family: Arial, sans-serif; background-color: #f4f7f9; }
        .container { max-width: 1200px; margin: auto; padding-top: 20px; }
        .schedule-card { border-left: 5px solid #007bff; margin-bottom: 15px; padding: 15px; background-color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status-badge { padding: 4px 8px; border-radius: 12px; font-size: 0.85em; font-weight: bold; }
        .status-pending { background-color: #ffc107; color: #343a40; }
        .status-confirmed { background-color: #28a745; color: white; }
        .status-cancelled { background-color: #dc3545; color: white; }
        .action-btn { margin-left: 10px; }

        /* Th√™m CSS c∆° b·∫£n cho Navbar v√¨ code g·ªëc kh√¥ng d√πng Tailwind */
        .navbar { background-color: white; border-bottom: 1px solid #ddd; padding: 10px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .navbar nav { display: flex; justify-content: flex-end; align-items: center; gap: 15px; max-width: 1200px; margin: auto; padding: 0 20px; }
        .navbar nav a { padding: 10px 15px; text-decoration: none; color: #343a40; font-weight: 600; }
        .navbar nav a.active { color: #007bff; border-bottom: 2px solid #007bff; }
        .navbar nav button { padding: 8px 15px; background-color: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

    <header class="navbar">
        <nav>
            <a href="../Trang_Chung_Va_Tiep_Can/index.html">Trang Ch·ªß</a> 
            <a href="doctor_schedule.html" class="active">L·ªãch Kh√°m</a>
            <a href="doctor_profile_edit.html">C·∫≠p Nh·∫≠t H·ªì S∆°</a>
            <button onclick="logout()">ƒêƒÉng Xu·∫•t</button>
        </nav>
    </header>

    <div class="container">
        <h1>üìÖ L·ªãch Kh√°m C·ªßa B√°c Sƒ©</h1>
        <p>Qu·∫£n l√Ω c√°c cu·ªôc h·∫πn kh√°m b·ªánh c·ªßa b·∫°n.</p>

        <div class="filter-controls" style="margin-bottom: 20px; background: #fff; padding: 15px; border-radius: 8px;">
            <div style="display: flex; gap: 15px; align-items: center;">
                
                <div>
                    <label for="date-select">Ch·ªçn Ng√†y:</label>
                    <input type="date" id="date-select" value="2025-11-12" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>

                <div>
                    <label for="status-filter">L·ªçc theo Tr·∫°ng th√°i:</label>
                    <select id="status-filter" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                        <option value="all">T·∫•t c·∫£</option>
                        <option value="pending">Ch·ªù x√°c nh·∫≠n</option>
                        <option value="confirmed">ƒê√£ x√°c nh·∫≠n</option>
                        <option value="cancelled">ƒê√£ h·ªßy</option>
                    </select>
                </div>

                <button onclick="applyFilters()" style="padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px;">√Åp D·ª•ng</button>
            </div>
        </div>

        <div id="appointment-list">
            <div class="schedule-card" data-status="pending" data-date="2025-11-12">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3>B·ªánh nh√¢n: **Nguy·ªÖn VƒÉn A**</h3>
                        <p><strong>Gi·ªù:</strong> 09:00 - 09:30</p>
                        <p><strong>L√Ω do:</strong> ƒêau ƒë·∫ßu k√©o d√†i v√† m·∫•t ng·ªß.</p>
                    </div>
                    <div>
                        <span class="status-badge status-pending">Ch·ªù x√°c nh·∫≠n</span>
                        <button class="action-btn" onclick="confirmAppointment(1)">X√°c Nh·∫≠n</button>
                        <button class="action-btn" onclick="openCancelModal(1)">H·ªßy L·ªãch</button>
                    </div>
                </div>
            </div>

            <div class="schedule-card" data-status="confirmed" data-date="2025-11-12">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3>B·ªánh nh√¢n: **Tr·∫ßn Th·ªã B**</h3>
                        <p><strong>Gi·ªù:</strong> 10:00 - 10:30</p>
                        <p><strong>L√Ω do:</strong> Ki·ªÉm tra ƒë·ªãnh k·ª≥ v√† t√°i kh√°m ti·ªÉu ƒë∆∞·ªùng.</p>
                    </div>
                    <div>
                        <span class="status-badge status-confirmed">ƒê√£ x√°c nh·∫≠n</span>
                        <button class="action-btn" onclick="viewDetails(2)">Xem Chi Ti·∫øt</button>
                    </div>
                </div>
            </div>
        </div>
        
    </div>

    <div id="cancel-modal" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center;">
        <div style="background: white; padding: 20px; border-radius: 8px; max-width: 400px;">
            <h2>X√°c nh·∫≠n H·ªßy L·ªãch</h2>
            <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy l·ªãch h·∫πn n√†y kh√¥ng?</p>
            <label for="cancel-reason">L√Ω do h·ªßy:</label>
            <textarea id="cancel-reason" style="width: 100%; margin-bottom: 15px;"></textarea>
            <button onclick="executeCancel()" style="background-color: #dc3545; color: white; padding: 10px;">X√°c Nh·∫≠n H·ªßy</button>
            <button onclick="closeCancelModal()" style="margin-left: 10px; padding: 10px;">ƒê√≥ng</button>
        </div>
    </div>


    <script>
        // D·ªØ li·ªáu gi·∫£ l·∫≠p cho l·ªãch h·∫πn
        const appointments = [
            { id: 1, patient: 'Nguy·ªÖn VƒÉn A', time: '09:00', reason: 'ƒêau ƒë·∫ßu k√©o d√†i', status: 'pending', date: '2025-11-12' },
            { id: 2, patient: 'Tr·∫ßn Th·ªã B', time: '10:00', reason: 'T√°i kh√°m ti·ªÉu ƒë∆∞·ªùng', status: 'confirmed', date: '2025-11-12' },
            { id: 3, patient: 'Ph·∫°m VƒÉn C', time: '14:30', reason: 'Kh√°m t·ªïng qu√°t', status: 'confirmed', date: '2025-11-13' },
            { id: 4, patient: 'L√™ Th·ªã D', time: '16:00', reason: 'T∆∞ v·∫•n dinh d∆∞·ª°ng', status: 'pending', date: '2025-11-13' },
            { id: 5, patient: 'V≈© ƒê√¨nh E', time: '17:00', reason: 'C·∫£m l·∫°nh', status: 'cancelled', date: '2025-11-12' },
        ];

        let currentAppointmentIdToCancel = null;

        // H√†m m√¥ ph·ªèng t·∫£i v√† hi·ªÉn th·ªã l·ªãch h·∫πn
        function renderAppointments(data) {
            const listElement = document.getElementById('appointment-list');
            listElement.innerHTML = ''; // X√≥a n·ªôi dung c≈©

            data.forEach(app => {
                const statusClass = 'status-' + app.status;
                const actions = (app.status === 'pending') ?
                    `<button class="action-btn" onclick="confirmAppointment(${app.id})">X√°c Nh·∫≠n</button>
                     <button class="action-btn" onclick="openCancelModal(${app.id})">H·ªßy L·ªãch</button>` :
                    (app.status === 'confirmed') ? 
                    `<button class="action-btn" onclick="viewDetails(${app.id})">Xem Chi Ti·∫øt</button>` :
                    '';

                const html = `
                    <div class="schedule-card" data-status="${app.status}" data-date="${app.date}">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3>B·ªánh nh√¢n: **${app.patient}**</h3>
                                <p><strong>Gi·ªù:</strong> ${app.time}</p>
                                <p><strong>L√Ω do:</strong> ${app.reason}</p>
                            </div>
                            <div>
                                <span class="status-badge ${statusClass}">${getStatusLabel(app.status)}</span>
                                ${actions}
                            </div>
                        </div>
                    </div>
                `;
                listElement.innerHTML += html;
            });

            if (data.length === 0) {
                 listElement.innerHTML = '<p style="padding: 20px; text-align: center; color: #6c757d;">Kh√¥ng t√¨m th·∫•y l·ªãch h·∫πn n√†o ph√π h·ª£p.</p>';
            }
        }

        // H√†m l·∫•y nh√£n tr·∫°ng th√°i
        function getStatusLabel(status) {
            switch (status) {
                case 'pending': return 'Ch·ªù x√°c nh·∫≠n';
                case 'confirmed': return 'ƒê√£ x√°c nh·∫≠n';
                case 'cancelled': return 'ƒê√£ h·ªßy';
                default: return 'Kh√¥ng r√µ';
            }
        }

        // H√†m √°p d·ª•ng b·ªô l·ªçc
        function applyFilters() {
            const selectedDate = document.getElementById('date-select').value;
            const selectedStatus = document.getElementById('status-filter').value;

            const filteredList = appointments.filter(app => {
                const dateMatch = (selectedDate === '' || app.date === selectedDate);
                const statusMatch = (selectedStatus === 'all' || app.status === selectedStatus);
                return dateMatch && statusMatch;
            });

            renderAppointments(filteredList);
        }

        // --- C√°c h√†m H√†nh ƒê·ªông (Action Functions) ---

        function confirmAppointment(id) {
            console.log(`API Call: X√°c nh·∫≠n l·ªãch h·∫πn ID: ${id}`);
            alert(`ƒê√£ g·ª≠i y√™u c·∫ßu x√°c nh·∫≠n l·ªãch h·∫πn ID: ${id}. (C·∫≠p nh·∫≠t tr·∫°ng th√°i b·∫±ng API)`);
            // Sau khi API th√†nh c√¥ng: C·∫≠p nh·∫≠t l·∫°i d·ªØ li·ªáu v√† render l·∫°i trang
            // V√≠ d·ª•: appointments.find(a => a.id === id).status = 'confirmed'; 
            // applyFilters(); 
        }

        function openCancelModal(id) {
            currentAppointmentIdToCancel = id;
            document.getElementById('cancel-modal').style.display = 'flex';
        }

        function closeCancelModal() {
            document.getElementById('cancel-modal').style.display = 'none';
            document.getElementById('cancel-reason').value = ''; // Reset l√Ω do
            currentAppointmentIdToCancel = null;
        }

        function executeCancel() {
            const id = currentAppointmentIdToCancel;
            const reason = document.getElementById('cancel-reason').value;

            if (!reason) {
                alert('Vui l√≤ng nh·∫≠p l√Ω do h·ªßy.');
                return;
            }

            console.log(`API Call: H·ªßy l·ªãch h·∫πn ID: ${id} v·ªõi l√Ω do: ${reason}`);
            alert(`ƒê√£ g·ª≠i y√™u c·∫ßu h·ªßy l·ªãch h·∫πn ID: ${id} v·ªõi l√Ω do: ${reason}. (C·∫≠p nh·∫≠t tr·∫°ng th√°i b·∫±ng API)`);
            
            // Sau khi API th√†nh c√¥ng: C·∫≠p nh·∫≠t l·∫°i d·ªØ li·ªáu v√† render l·∫°i trang
            // V√≠ d·ª•: appointments.find(a => a.id === id).status = 'cancelled'; 
            closeCancelModal();
            // applyFilters(); 
        }

        function viewDetails(id) {
            console.log(`M·ªü Modal/Trang chi ti·∫øt b·ªánh nh√¢n cho ID: ${id}`);
            alert(`M√¥ ph·ªèng: M·ªü Modal xem chi ti·∫øt b·ªánh nh√¢n cho l·ªãch h·∫πn ID: ${id}`);
        }

        function logout() {
            console.log('ƒêƒÉng xu·∫•t B√°c sƒ©');
            // S·ª¨A: ƒê∆∞·ªùng d·∫´n ƒêƒÉng Xu·∫•t (Trang_Chung_Va_Tiep_Can/login_register.html)
            window.location.href = '../Trang_Chung_Va_Tiep_Can/login_register.html';
        }
        
        // T·∫£i l·ªãch h·∫πn ban ƒë·∫ßu khi trang ƒë∆∞·ª£c t·∫£i
        document.addEventListener('DOMContentLoaded', () => {
             // ƒê·∫∑t ng√†y m·∫∑c ƒë·ªãnh l√† ng√†y h√¥m nay cho input date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date-select').value = today;
            applyFilters();
        });

    </script>
</body>
</html>