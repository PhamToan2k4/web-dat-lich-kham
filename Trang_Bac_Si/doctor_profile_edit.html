<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C·∫≠p Nh·∫≠t H·ªì S∆° - B√°c Sƒ©</title>
    <link rel="stylesheet" href="../assets/css/style.css"> 
    <style>
        /* CSS C∆° B·∫£n Cho Trang N√†y */
        body { font-family: Arial, sans-serif; background-color: #f4f7f9; }
        .container { max-width: 1000px; margin: auto; padding-top: 20px; }
        .profile-section { background-color: white; padding: 25px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 5px; }
        .form-group input[type="text"], .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .profile-pic-container { text-align: center; margin-bottom: 20px; }
        .profile-pic-container img { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid #007bff; }
        .schedule-table th, .schedule-table td { padding: 10px; border: 1px solid #ddd; text-align: center; }
        .schedule-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        
        /* Th√™m CSS c∆° b·∫£n t·ª´ c·∫•u h√¨nh Tailwind ƒë·ªÉ ƒë·∫£m b·∫£o style kh√¥ng b·ªã m·∫•t */
        .navbar { background-color: white; border-bottom: 1px solid #ddd; padding: 10px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .navbar nav a { padding: 10px 15px; text-decoration: none; color: #343a40; font-weight: 600; }
        .navbar nav a.active { color: #007bff; border-bottom: 2px solid #007bff; }
        .navbar nav button { padding: 8px 15px; background-color: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; float: right; }
    </style>
</head>
<body>

    <header class="navbar">
        <div class="container">
            <nav style="display: flex; justify-content: flex-end; align-items: center; gap: 15px;">
                <a href="doctor_schedule.html">L·ªãch Kh√°m</a>
                <a href="doctor_profile_edit.html" class="active">C·∫≠p Nh·∫≠t H·ªì S∆°</a>
                <button onclick="logout()">ƒêƒÉng Xu·∫•t</button>
            </nav>
        </div>
    </header>

    <div class="container">
        <h1>üõ†Ô∏è C·∫≠p Nh·∫≠t H·ªì S∆° Chuy√™n M√¥n</h1>
        <p>Qu·∫£n l√Ω th√¥ng tin hi·ªÉn th·ªã c√¥ng khai v√† l·ªãch l√†m vi·ªác c·ªßa b·∫°n.</p>
        
        <div style="text-align: right; margin-bottom: 20px;">
            <button onclick="saveAllChanges()" style="padding: 12px 25px; background-color: #28a745; color: white; border: none; border-radius: 4px; font-size: 1.1em; cursor: pointer;">
                L∆∞u T·∫•t C·∫£ C·∫≠p Nh·∫≠t
            </button>
        </div>

        <div class="profile-section">
            <h2>1. Th√¥ng Tin H·ªì S∆° & Chuy√™n M√¥n</h2>

            <div class="profile-pic-container">
                <img id="profile-image" src="../images/default_doctor.jpg" alt="·∫¢nh ƒë·∫°i di·ªán">
                <input type="file" id="profile-image-upload" accept="image/*" onchange="previewImage(event)" style="margin-top: 10px;">
            </div>

            <div class="form-group">
                <label for="doctor-name">H·ªç T√™n:</label>
                <input type="text" id="doctor-name" value="BS. Nguy·ªÖn VƒÉn Kh·ªèe" readonly>
                <small>H·ªç t√™n kh√¥ng th·ªÉ thay ƒë·ªïi, li√™n h·ªá Qu·∫£n tr·ªã vi√™n n·∫øu c·∫ßn.</small>
            </div>

            <div class="form-group">
                <label for="specialty">Chuy√™n Khoa Ch√≠nh:</label>
                <select id="specialty">
                    <option value="tim_mach">Tim M·∫°ch</option>
                    <option value="da_lieu" selected>Da Li·ªÖu</option>
                    <option value="nha_khoa">Nha Khoa</option>
                </select>
            </div>

            <div class="form-group">
                <label for="bio">M√¥ T·∫£ C√° Nh√¢n (Bio - T·ªëi ƒëa 500 k√Ω t·ª±):</label>
                <textarea id="bio" rows="4">B√°c sƒ© chuy√™n khoa Da Li·ªÖu v·ªõi 10 nƒÉm kinh nghi·ªám ƒëi·ªÅu tr·ªã m·ª•n tr·ª©ng c√°, vi√™m da c∆° ƒë·ªãa v√† c√°c b·ªánh l√Ω v·ªÅ t√≥c. T·∫≠n t√¢m v√† lu√¥n c·∫≠p nh·∫≠t ph∆∞∆°ng ph√°p ƒëi·ªÅu tr·ªã m·ªõi nh·∫•t.</textarea>
            </div>

            <div class="form-group">
                <label for="experience">Kinh nghi·ªám & B·∫±ng c·∫•p (Li·ªát k√™):</label>
                <textarea id="experience" rows="6">
- T·ªët nghi·ªáp ƒê·∫°i h·ªçc Y D∆∞·ª£c TP.HCM (2015)
- 10 nƒÉm c√¥ng t√°c t·∫°i B·ªánh vi·ªán Da Li·ªÖu Trung ∆Ø∆°ng
- Ch·ª©ng ch·ªâ ƒëi·ªÅu tr·ªã laser th·∫©m m·ªπ
                </textarea>
            </div>
        </div>

        <div class="profile-section">
            <h2>2. Qu·∫£n L√Ω Gi·ªù L√†m Vi·ªác (L·ªãch C√¥ng Khai)</h2>
            <p>Thi·∫øt l·∫≠p khung gi·ªù b·∫°n s·∫Ω c√≥ m·∫∑t ƒë·ªÉ nh·∫≠n l·ªãch h·∫πn t·ª´ b·ªánh nh√¢n.</p>

            <table id="schedule-management" class="schedule-table">
                <thead>
                    <tr>
                        <th>Ng√†y</th>
                        <th>Gi·ªù B·∫Øt ƒê·∫ßu</th>
                        <th>Gi·ªù K·∫øt Th√∫c</th>
                        <th>H√†nh ƒê·ªông</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
            
            <div style="margin-top: 20px;">
                <label for="new-day">Th√™m Gi·ªù L√†m Vi·ªác M·ªõi:</label>
                <select id="new-day" style="padding: 8px;">
                    <option value="T2">Th·ª© Hai</option>
                    <option value="T3">Th·ª© Ba</option>
                    <option value="T4">Th·ª© T∆∞</option>
                    <option value="T5">Th·ª© NƒÉm</option>
                    <option value="T6">Th·ª© S√°u</option>
                    <option value="T7">Th·ª© B·∫£y</option>
                    <option value="CN">Ch·ªß Nh·∫≠t</option>
                </select>
                <input type="time" id="new-start-time" value="09:00" style="padding: 8px; margin: 0 5px;">
                ƒë·∫øn
                <input type="time" id="new-end-time" value="11:00" style="padding: 8px; margin: 0 5px;">
                <button onclick="addScheduleSlot()" style="padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px;">Th√™m Slot</button>
            </div>
        </div>

    </div>

    <script>
        // D·ªØ li·ªáu gi·∫£ l·∫≠p h·ªì s∆° v√† l·ªãch l√†m vi·ªác
        let doctorProfile = {
            name: "BS. Nguy·ªÖn VƒÉn Kh·ªèe",
            specialty: "da_lieu",
            bio: "B√°c sƒ© chuy√™n khoa Da Li·ªÖu v·ªõi 10 nƒÉm kinh nghi·ªám ƒëi·ªÅu tr·ªã m·ª•n tr·ª©ng c√°, vi√™m da c∆° ƒë·ªãa v√† c√°c b·ªánh l√Ω v·ªÅ t√≥c. T·∫≠n t√¢m v√† lu√¥n c·∫≠p nh·∫≠t ph∆∞∆°ng ph√°p ƒëi·ªÅu tr·ªã m·ªõi nh·∫•t.",
            experience: "- T·ªët nghi·ªáp ƒê·∫°i h·ªçc Y D∆∞·ª£c TP.HCM (2015)\n- 10 nƒÉm c√¥ng t√°c t·∫°i B·ªánh vi·ªán Da Li·ªÖu Trung ∆Ø∆°ng\n- Ch·ª©ng ch·ªâ ƒëi·ªÅu tr·ªã laser th·∫©m m·ªπ",
            schedule: [
                { day: "T2", start: "08:00", end: "12:00" },
                { day: "T4", start: "14:00", end: "17:00" },
                { day: "T7", start: "09:00", end: "11:00" }
            ]
        };

        // --- H√†m t·∫£i d·ªØ li·ªáu l√™n Form ---
        function loadProfileData() {
            document.getElementById('doctor-name').value = doctorProfile.name;
            document.getElementById('specialty').value = doctorProfile.specialty;
            document.getElementById('bio').value = doctorProfile.bio;
            document.getElementById('experience').value = doctorProfile.experience.trim();
            renderSchedule();
        }

        // --- H√†m hi·ªÉn th·ªã L·ªãch l√†m vi·ªác ---
        function renderSchedule() {
            const tbody = document.querySelector('#schedule-management tbody');
            tbody.innerHTML = '';
            
            doctorProfile.schedule.sort((a, b) => {
                const dayOrder = ['T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'CN'];
                return dayOrder.indexOf(a.day) - dayOrder.indexOf(b.day);
            });

            doctorProfile.schedule.forEach((slot, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${slot.day}</td>
                    <td><input type="time" value="${slot.start}" data-index="${index}" data-field="start" onchange="updateScheduleSlot(${index}, 'start', this.value)"></td>
                    <td><input type="time" value="${slot.end}" data-index="${index}" data-field="end" onchange="updateScheduleSlot(${index}, 'end', this.value)"></td>
                    <td><button onclick="removeScheduleSlot(${index})" style="background-color: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px;">X√≥a</button></td>
                `;
            });
        }

        // --- H√†m th√™m Slot m·ªõi ---
        function addScheduleSlot() {
            const day = document.getElementById('new-day').value;
            const start = document.getElementById('new-start-time').value;
            const end = document.getElementById('new-end-time').value;

            if (start >= end) {
                alert('Gi·ªù k·∫øt th√∫c ph·∫£i l·ªõn h∆°n gi·ªù b·∫Øt ƒë·∫ßu.');
                return;
            }

            doctorProfile.schedule.push({ day, start, end });
            renderSchedule();
        }

        // --- H√†m c·∫≠p nh·∫≠t Slot (khi thay ƒë·ªïi input time) ---
        function updateScheduleSlot(index, field, value) {
            doctorProfile.schedule[index][field] = value;
            // Ki·ªÉm tra logic gi·ªù sau khi c·∫≠p nh·∫≠t (c√≥ th·ªÉ th√™m)
            console.log(`C·∫≠p nh·∫≠t slot ${index}, field ${field} th√†nh ${value}`);
        }

        // --- H√†m x√≥a Slot ---
        function removeScheduleSlot(index) {
            if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a khung gi·ªù n√†y kh√¥ng?")) {
                doctorProfile.schedule.splice(index, 1);
                renderSchedule();
            }
        }

        // --- H√†m xem tr∆∞·ªõc ·∫£nh ƒë·∫°i di·ªán ---
        function previewImage(event) {
            const reader = new FileReader();
            reader.onload = function(){
                const output = document.getElementById('profile-image');
                output.src = reader.result;
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        // --- H√†m L∆∞u T·∫•t C·∫£ ---
        function saveAllChanges() {
            // 1. L·∫•y d·ªØ li·ªáu m·ªõi t·ª´ Form
            const newProfileData = {
                specialty: document.getElementById('specialty').value,
                bio: document.getElementById('bio').value,
                experience: document.getElementById('experience').value,
                schedule: doctorProfile.schedule // L·ªãch l√†m vi·ªác ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t qua c√°c h√†m tr√™n
            };
            
            // 2. G·ª≠i d·ªØ li·ªáu qua API
            console.log("D·ªØ li·ªáu g·ª≠i ƒëi:", newProfileData);
            alert('‚úÖ C·∫≠p nh·∫≠t h·ªì s∆° th√†nh c√¥ng! D·ªØ li·ªáu c√¥ng khai ƒë√£ ƒë∆∞·ª£c thay ƒë·ªïi.');

            // Sau khi l∆∞u, c√≥ th·ªÉ chuy·ªÉn h∆∞·ªõng v·ªÅ trang l·ªãch kh√°m
            window.location.href = 'doctor_schedule.html'; 
        }

        function logout() {
            console.log('ƒêƒÉng xu·∫•t B√°c sƒ©');
            // S·ª¨A: ƒê∆∞·ªùng d·∫´n ƒêƒÉng Xu·∫•t (Trang_Chung_Va_Tiep_Can/login_register.html)
            window.location.href = '../Trang_Chung_Va_Tiep_Can/login_register.html';
        }

        // T·∫£i d·ªØ li·ªáu ban ƒë·∫ßu khi trang ƒë∆∞·ª£c t·∫£i
        document.addEventListener('DOMContentLoaded', loadProfileData);
    </script>
</body>
</html>